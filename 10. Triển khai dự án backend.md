# Triển khai dự án backend

1. cài đặt các công cụ cần thiết => công cụ
2. xem và sửa file cấu hình > file cấu hình
3. cài đặt và thiết lập database => công cụ
4. build dự án => build
5. run dự án => run
6. kiểm tra hoạt động => check

## thực hiện

- cài java 17: `apt install openjdk-17-jdk openjdk-17-jre`, `java -version`
- cài maven: `sudo apt install maven`, `mvn -v`
- để xem thông tin db thì vào file `vi src/main/resources/application.properties` để xem.
- cài mariadb-server: `apt install mariadb-server`
- chạy lệnh `netstat -tlpun` để kiểm tra các port, lúc này ta thấy mysql chạy trên cổng `127.0.0.1:3306`, đây là link localhost, do đó không thể truy cập từ server khác, cần sửa config lại
- stop mariadb trước: `systemctl stop mariadb`
- check ở trong `ls /etc/mysql/mariadb.conf.d/`, có file 50-server.cnf.
- mở file đó ra, `vi /etc/mysql/mariadb.conf.d/50-server.cnf`, sửa dòng bind-address thành `0.0.0.0`, lưu lại
- khởi động lại mariadb `systemctl restart mariadb`
- check lại `netstat -tlpun`, lúc này ta thấy mysqld đã đổi port thành 0.0.0.0:3306
- đăng nhập vào hệ quản trị cơ sở dữ liệu MariaDB/MySQL với tài khoản root: `mysql -u root` (-u là user)
- tạo 1 database cho shoeshop: `create database shoeshop;`
- tạo 1 user: `create user 'shoeshop'@'%' identified by 'shoeshop';`
  - 'username'@'host'
    → có nghĩa là user chỉ được phép đăng nhập từ một địa chỉ IP hoặc host cụ thể nào đó.
  - 'shoeshop'@'%' → được phép đăng nhập từ mọi nơi
  - identified by: đặt mật khẩu
  - cấu trúc chung: `CREATE USER 'username'@'host' IDENTIFIED BY 'password';`
- gán quyền cho user:

  - cấu trúc chung: `GRANT ALL PRIVILEGES ON yourdbname.* TO 'username'@'%'; FLUSH PRIVILEGES;`,
  - grant: là lệnh cấp quyền, ALL PRIVILEGES = cấp tất cả quyền cần thiết cho user với database(đọc, thêm, sửa, xóa ...), yourdbname = tên database, \* = tất cả các bảng trong database đó, TO 'username'@'%': '%' = host (nghĩa là bất kỳ IP nào đều có thể login). FLUSH PRIVILEGES: Tải lại quyền đã cấp ngay lập tức. Không bắt buộc 100% trong mọi tình huống, nhưng nên chạy sau GRANT.
  - `grant all privileges on shoeshop.* to 'shoeshop'@'%';`

- gõ lệnh `exit` để thoát ra khỏi gõ lệnh của mariadb, đăng nhập lại bằng user shoeshop để xem có thấy được database của shoeshop không
- `mysql -h 192.168.126.240 -P 3306 -u shoeshop -p`
  - `-h`: host
  - `-P`: port
  - `-u`: user name
  - `-p`: nhập mật khẩu
- xem databse: `show databases;`, ta thấy có 1 database là shoeshop
- import file shoe_shopdb.sql ở trong dự án vào trong databse mysql:
  - sử dụng shoeshop db: `use shoeshop;`
  - `show tables;` để xem table, hiện tại đang trống.
  - `source /projects/shoesshop/shoe_shopdb.sql;` để kết nối
  - `show tables` để xem những tables có trong db
- sửa lại file config `vi src/main/resources/application.properties`:
  - address: 192.168.126.240
  - port: 3306
  - user name: shoeshop
  - pw: shoeshop
  - spring.datasource.url=jdbc:mysql://192.168.126.240:3306/shoeshop
- chạy `mvn install -DskipTests=true`
- sau khi chạy xong thì ta thấy folder `target`, ở trong target ta thấy có 1 file `file.jar`
- chạy lệnh `java -jar target/file.jar`
- tuy nhiên chạy như này thì k thao tác được trên terminal, chạy lệnh `nohup java -jar target/file.jar 2>&1 &`, lúc này sẽ chạy dưới nền, và tạo ra 1 file log `nohub.out`
- chạy lệnh `ps -ef| grep shoe` để xem các tiến trình
