## ta Ä‘ang cÃ³ dá»± Ã¡n tÃªn lÃ  vision

### cháº¡y trong mÃ´i trÆ°á»ng dev Ä‘á»ƒ test

- táº¡o file service cho dá»± Ã¡n: `vi /lib/systemd/system/vision.service`
- á»Ÿ trong file Ä‘iá»n cÃ¡c ná»™i dung sau:

```
[Service]
Type=simple
User=vision
Restart=on-failure
WorkingDirectory=/projects/vision/
ExecStart=npm run start -- --port=3000
```

- lÆ°u file láº¡i vÃ  cháº¡y lá»‡nh `systemctl daemon-reload`, `systemctl start vision`
- cháº¡y lá»‡nh `systemctl status vision` Ä‘á»ƒ xem tráº¡ng thÃ¡i

### DÃ¹ng serve Ä‘á»ƒ cháº¡y static build

1. Build dá»± Ã¡n

```
npm run build
```

2. CÃ i `serve` toÃ n há»‡ thá»‘ng

```
sudo npm install -g serve
```

3. Táº¡o file service Ä‘Ãºng chuáº©n

```
sudo vi /lib/systemd/system/vision.service
```

Ná»™i dung:

```
[Unit]
Description=React Vision App
After=network.target

[Service]
Type=simple
User=vision
WorkingDirectory=/projects/vision
ExecStart=/usr/bin/serve -s build -l 3000
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

âš ï¸ LÆ°u Ã½: path `/usr/bin/serve` dÃ¹ng `which serve` Ä‘á»ƒ kiá»ƒm tra. kiá»ƒm tra xem serve Ä‘Æ°á»£c Ä‘áº·t á»Ÿ Ä‘Ã¢u

Giáº£i thÃ­ch:

- After=network.target

  - Service sáº½ chá»‰ Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng sau khi máº¡ng Ä‘Ã£ sáºµn sÃ ng.

  - Äáº£m báº£o ráº±ng server cÃ³ máº¡ng trÆ°á»›c khi cháº¡y (vÃ¬ serve hoáº·c app dÃ¹ng port).

  - â¡ï¸ Náº¿u khÃ´ng cÃ³ dÃ²ng nÃ y, service cÃ³ thá»ƒ cháº¡y trÆ°á»›c khi máº¡ng khá»Ÿi Ä‘á»™ng â†’ gÃ¢y lá»—i.

- Type=simple

  - simple = kiá»ƒu cháº¡y máº·c Ä‘á»‹nh.

  - Nháº­n Ä‘á»‹nh ráº±ng chÆ°Æ¡ng trÃ¬nh cháº¡y á»Ÿ foreground vÃ  khÃ´ng fork process.

  - PhÃ¹ há»£p vá»›i serve, Node.js, Python, Goâ€¦

  - â¡ï¸ Dá»‹ch vá»¥ sáº½ cháº¡y trá»±c tiáº¿p, khÃ´ng cáº§n quÃ¡ trÃ¬nh phá»©c táº¡p.

- User=vision

  - Service sáº½ Ä‘Æ°á»£c cháº¡y dÆ°á»›i quyá»n user vision (khÃ´ng pháº£i root).

  - Báº£o máº­t hÆ¡n ráº¥t nhiá»u so vá»›i cháº¡y báº±ng root.

  - User nÃ y pháº£i cÃ³ quyá»n Ä‘á»c thÆ° má»¥c /projects/vision.

  - â¡ï¸ Dá»‹ch vá»¥ cháº¡y an toÃ n, tÃ¡ch biá»‡t user.

- WorkingDirectory=/projects/vision

  - Äáº·t thÆ° má»¥c lÃ m viá»‡c cho service.

  - ÄÃ¢y lÃ  nÆ¡i chá»©a thÆ° má»¥c build cá»§a báº¡n.

  - CÃ¡c Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i trong ExecStart sáº½ dá»±a vÃ o thÆ° má»¥c nÃ y.

  - â¡ï¸ Khi service cháº¡y, nÃ³ â€œÄ‘á»©ngâ€ trong thÆ° má»¥c nÃ y.

- ExecStart=/usr/bin/serve -s build -l 3000

  - Lá»‡nh Ä‘á»ƒ cháº¡y á»©ng dá»¥ng má»—i láº§n service khá»Ÿi cháº¡y.

  - `/usr/bin/serve` lÃ  Ä‘Æ°á»ng dáº«n tá»›i chÆ°Æ¡ng trÃ¬nh serve (kiá»ƒm tra báº±ng which serve).

  - `-s build` â†’ cháº¡y serve á»Ÿ cháº¿ Ä‘á»™ static, dÃ¹ng thÆ° má»¥c build.

  - `-l 3000` â†’ cháº¡y server á»Ÿ port 3000.

  - â¡ï¸ ÄÃ¢y lÃ  cÃ¢u quan trá»ng nháº¥t, quyáº¿t Ä‘á»‹nh cÃ¡ch cháº¡y ReactJS.

- Restart=always

  - Náº¿u chÆ°Æ¡ng trÃ¬nh bá»‹ lá»—i, crash hoáº·c dá»«ng báº¥t thÆ°á»ng thÃ¬ systemd sáº½ tá»± Ä‘á»™ng khá»Ÿi Ä‘á»™ng láº¡i.

  - â¡ï¸ GiÃºp á»©ng dá»¥ng cháº¡y á»•n Ä‘á»‹nh 24/7.

- RestartSec=3

  - Thá»i gian chá» 3 giÃ¢y trÆ°á»›c khi restart láº¡i service sau khi bá»‹ crash.

  - â¡ï¸ TrÃ¡nh restart liÃªn tá»¥c gÃ¢y quÃ¡ táº£i.

ğŸ”´ [Install] â€” Pháº§n thiáº¿t láº­p thá»i Ä‘iá»ƒm khá»Ÿi Ä‘á»™ng

- WantedBy=multi-user.target

  - XÃ¡c Ä‘á»‹nh runlevel mÃ  service sáº½ Ä‘Æ°á»£c báº­t khi boot há»‡ thá»‘ng.

  - multi-user.target = cháº¿ Ä‘á»™ server cÃ³ nhiá»u ngÆ°á»i dÃ¹ng (khÃ´ng giao diá»‡n).

  - â¡ï¸ NÃ³i Ä‘Æ¡n giáº£n:
    Service sáº½ tá»± cháº¡y khi mÃ¡y khá»Ÿi Ä‘á»™ng.

4. KÃ­ch hoáº¡t service

```
sudo systemctl daemon-reload
sudo systemctl start vision
sudo systemctl enable vision
sudo systemctl status vision
```

ğŸ‘‰ Truy cáº­p: `http://server-ip:3000`
