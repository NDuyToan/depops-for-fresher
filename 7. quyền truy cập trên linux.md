# BÀI 7: QUYỀN TRUY CẬP TRÊN LINUX

## Thêm user

- `sudo useradd [tùy chọn] tên_user`: Là lệnh cấp thấp (low-level), Không tạo mật khẩu, thư mục home, shell nếu không chỉ định, Cần chỉ định nhiều tùy chọn thủ công. chỉ tạo ra user thôi

- `sudo adduser tên_user`: Là lệnh cấp cao (high-level), Tự động tạo thư mục home, shell, group, và hỏi mật khẩu, Có giao diện tương tác (interactive). Có thể truy cập thông qua ssh 1 cách bình thường, địa chỉ IP vẫn như cũ, chỉ thay đổi username thôi

## Chuyển user

- `su <tên user>`

## Xem các user

- `cat /etc/passwd`

## Xóa user

- `deluser <ten_user>`

## Lệnh tạo nhóm người dùng:

- `sudo groupadd [tùy chọn] tên_group`
- giúp bạn tạo nhóm người dùng để dễ dàng phân quyền, chia sẻ tài nguyên và quản lý bảo mật trong hệ thống Linux.

## Xóa nhóm người dùng: `delgroup <tên group>`

## Xem các group

- `cat /etc/group`

## thêm một user vào một group:

- `sudo usermod -aG <tên_group> <tên_user>`

| Thành phần    | Ý nghĩa                                                  |
| ------------- | -------------------------------------------------------- |
| `sudo`        | Chạy với quyền quản trị (root)                           |
| `usermod`     | Lệnh để **chỉnh sửa thông tin user**                     |
| `-a`          | (append) – **thêm vào** nhóm phụ, không xóa nhóm hiện có |
| `-G`          | (groups) – Chỉ định **tên nhóm** cần thêm user vào       |
| `<tên_group>` | Tên nhóm mà bạn muốn thêm user                           |
| `<tên_user>`  | Tên người dùng cần được thêm                             |

## Xem user thuộc group nào

- `groups <tên user>`
- khi tạo 1 user thì đồng thời sẽ tạo 1 group, và user sẽ thuộc group đó luôn

## Xóa user thuộc 1 group

- `deluser <tên user> <tên group>`

## Thay đổi quyền sở hữu của file hoặc thư mục

- `sudo chown [tùy chọn] user:group file`
- Gán một user khác làm chủ sở hữu (owner),
- Và/hoặc gán một group khác làm nhóm sở hữu (group owner) cho file hoặc thư mục.
- Khi dùng lệnh `ls -l` (long format), sẽ cho ra cột `chủ sở hữu (user owner)` và `nhóm sở hữu (group owner)`

### Một số tùy chọn hữu ích

| Tùy chọn                 | Mô tả                                         |
| ------------------------ | --------------------------------------------- |
| `-R`                     | Thay đổi quyền sở hữu **đệ quy (recursive)**  |
| `-v`                     | Hiển thị chi tiết từng thay đổi (verbose)     |
| `-c`                     | Chỉ hiển thị khi có thay đổi xảy ra (changes) |
| `--reference=<file_mẫu>` | Đặt quyền sở hữu giống như file mẫu           |

- Khi sử dụng lệnh `ls -l` thì cho ra kết quả như sau:
  | Cột | Ý nghĩa |
  | --- | ------------------------------ |
  | 1️⃣ | Quyền truy cập (permission) |
  | 2️⃣ | Số lượng liên kết (hard links) |
  | 3️⃣ | **Chủ sở hữu (user owner)** |
  | 4️⃣ | **Nhóm sở hữu (group owner)** |
  | 5️⃣ | Kích thước file (bytes) |
  | 6️⃣ | Thời gian chỉnh sửa cuối cùng |
  | 7️⃣ | Tên file hoặc thư mục |

-`drwxr-xr-x 2 root dev2 4096 Nov 11 02:41 datas`: chữ `d` (directory) đầu tiên xác định đây là folder hoặc file, có `d` nghĩa là folder, (d = directory, - = file, l = link), `rwxr-xr-x` là quyền của các user, 1 lớp user có 3 cái, tương ứng là `w (write)`, `x(execute)`,`r(read)`, 3 lớp quyền tương ứng là user, group, others

- giờ ta sẽ bàn vè cột số 1 - Quyền truy cập

### Cách Linux xác định quyền truy cập

Mỗi file có 3 lớp quyền:
| Lớp | Mô tả | Áp dụng cho |
| --- | ---------- | ------------------------- |
| `u` | **user** | Chủ sở hữu (user owner) |
| `g` | **group** | Nhóm sở hữu (group owner) |
| `o` | **others** | Tất cả người dùng khác |

Khi bạn chạy lệnh `ls -l` và thấy kết quả như:
`drwxr-xr-x 2 root dev2 4096 Nov 11 02:41 datas`
thì dòng này thể hiện quyền truy cập (permissions) của thư mục hoặc file.
Phần `drwxr-xr-x` chính là mã quyền truy cập (permission string).

#### 1. Cấu trúc chung

Dạng đầy đủ:

```php
drwxr-xr-x
```

Được chia thành 4 phần:
| Phần | Ký tự | Ý nghĩa |
| ---- | ----- | -------------------------------------------------------- |
| 1 | `d` | Loại đối tượng (`d` = directory, `-` = file, `l` = link) |
| 2–4 | `rwx` | Quyền của **user (chủ sở hữu)** |
| 5–7 | `r-x` | Quyền của **group (nhóm sở hữu)** |
| 8–10 | `r-x` | Quyền của **others (người khác)** |

#### 2. Ý nghĩa từng ký tự r, w, x

| Ký tự | Viết tắt của | Nghĩa    | Mô tả                                                            |
| ----- | ------------ | -------- | ---------------------------------------------------------------- |
| `r`   | **read**     | Đọc      | Cho phép xem nội dung file (hoặc liệt kê thư mục)                |
| `w`   | **write**    | Ghi      | Cho phép sửa/xóa nội dung file (hoặc tạo/xóa file trong thư mục) |
| `x`   | **execute**  | Thực thi | Cho phép **chạy file** hoặc **truy cập vào thư mục**             |

## Lệnh `chmod` — Change Mode - thay đổi quyền truy cập (permissions) của file hoặc thư mục

### Cú pháp cơ bản

```
chmod [tùy chọn] [quyền] [tên_file hoặc thư_mục]
```

| Thành phần   | Ý nghĩa                                                    |
| ------------ | ---------------------------------------------------------- |
| `chmod`      | Lệnh thay đổi quyền (change mode)                          |
| `[tùy chọn]` | Có thể là `-R` để áp dụng đệ quy                           |
| `[quyền]`    | Kiểu quyền bạn muốn gán (theo **ký hiệu chữ** hoặc **số**) |
| `[tên_file]` | File hoặc thư mục cần thay đổi quyền                       |

### Hai cách để đặt quyền

1. Cách 1: Dùng ký hiệu chữ (`r`, `w`, `x`)

| Ký tự | Nghĩa                                   | Mô tả          |
| ----- | --------------------------------------- | -------------- |
| `r`   | **read**                                | Quyền đọc      |
| `w`   | **write**                               | Quyền ghi      |
| `x`   | **execute**                             | Quyền thực thi |
| `u`   | **user** (chủ sở hữu)                   |                |
| `g`   | **group** (nhóm sở hữu)                 |                |
| `o`   | **others** (người khác)                 |                |
| `a`   | **all** (tất cả: user + group + others) |                |

Ví dụ:

- `chmod u+x file.sh` => Thêm quyền thực thi (execute) cho chủ sở hữu (user).
- `chmod g-w report.txt` => Xóa quyền ghi (write) khỏi nhóm (group).
- `chmod a+r notes.txt` => Cho phép **mọi người** có quyền **đọc** file.
- `chmod g=rwx notes.txt` => cho phép group có các quyền `r`, `w`, `x`
- `chmod u=rwx, g=rx, o=-` => user có 3 quyền, group có 2 quyền, other không có quyền nào cả

2. **Cách 2: Dùng hệ số bát phân (Octal)**
   Linux biểu diễn quyền truy cập bằng **số từ 0–7**, tương ứng với `rwx`.

| Quyền | Nhị phân | Giá trị |
| ----- | -------- | ------- |
| `---` | 000      | 0       |
| `--x` | 001      | 1       |
| `-w-` | 010      | 2       |
| `-wx` | 011      | 3       |
| `r--` | 100      | 4       |
| `r-x` | 101      | 5       |
| `rw-` | 110      | 6       |
| `rwx` | 111      | 7       |

cho dễ hiểu thì r=4, w=2,x=1 => tất cả quyền thì 4+2+1=7

Cấu trúc: `chmod [user][group][others] file`

- `chmod 750 data.txt` => user cả 3 quyền, group quyền `r`, `x`, other k có quyền gì
